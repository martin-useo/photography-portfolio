<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Martin USEO - Portfolio</title>
  <meta name="description"
    content="Hello there, I'm Martin USEO – a freelance photographer based in Paris, France. Welcome to my portfolio." />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://martin-useo.github.io/photography-portfolio/" />
  <meta property="og:title" content="Martin USEO - Portfolio" />
  <meta property="og:description" content="Hello there, I'm Martin USEO – a freelance photographer based in Paris, France. Welcome to my portfolio." />
  <meta property="og:image" content="https://martin-useo.github.io/photography-portfolio/assets/Avatar.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://martin-useo.github.io/photography-portfolio/" />
  <meta name="twitter:title" content="Martin USEO - Portfolio" />
  <meta name="twitter:description" content="Hello there, I'm Martin USEO – a freelance photographer based in Paris, France. Welcome to my portfolio." />
  <meta name="twitter:image" content="https://martin-useo.github.io/photography-portfolio/assets/Avatar.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <link rel="stylesheet" href="css/output.css" />
  <style>
    #button-text-fr,
    #button-text-en {
      transition: opacity 800ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: opacity;
    }
  </style>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Start - Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Signika:wght@400;700&display=swap" rel="stylesheet">
  <!-- End - Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      content: ["./pages/**/*.{html,js}", "./js/**/*.{html,js}"],
      theme: {
        extend:
                {
                  fontFamily: {
                    'nothingyoucoulddo': ['Nothing You Could Do', 'cursive'],
                    'signika': ['Signika', 'sans-serif'],
                  },
                },
      },
      plugins: [],
    }
  </script>
</head>

<body
  class="dark:bg-black bg-white h-screen text-black dark:text-white opacity-0 animate-fade-in transition duration-500 overflow-hidden">
  <!-- Background Canvas with Images -->
  <div class="fixed inset-0 w-full h-full z-0" id="background-canvas">
    <div class="flex flex-wrap w-full h-full items-stretch transition-opacity duration-500" id="portfolio-grid">
    </div>
    <!-- Overlay for better button visibility -->
    <div class="absolute inset-0 bg-black/30 dark:bg-black/50"></div>
  </div>

  <!-- Main Content - Title and Button -->
  <div class="relative z-10 h-screen flex flex-col items-center justify-center overflow-hidden px-4">
    <h1 class="text-6xl md:text-8xl font-signika font-bold text-white mb-12 text-center drop-shadow-2xl">
      MARTIN USEO
    </h1>
    <a href="pages/portfolio/nature.html" 
       id="portfolio-button"
       class="px-8 md:px-12 py-4 md:py-6 bg-white/70 dark:bg-white/10 backdrop-blur-sm text-black dark:text-white text-xl md:text-2xl font-signika font-bold rounded-lg shadow-lg hover:bg-white/80 dark:hover:bg-white/20 transition-all duration-300 transform hover:scale-105 active:scale-100 md:hover:scale-105 border-2 border-black/20 dark:border-white/20 relative">
      <span id="button-text-fr">DÉCOUVRIR LE PORTFOLIO</span>
      <span id="button-text-en" class="absolute inset-0 flex items-center justify-center opacity-0">DISCOVER THE PORTFOLIO</span>
    </a>
  </div>

  <script src="js/images-config.js"></script>
  <script>
    // Layouts prédéfinis pour la disposition des images
    const LAYOUTS = [
      {
        name: 'portrait-left-landscape-right',
        description: 'Portrait à gauche, deux paysages à droite',
        structure: [
          { width: 'md:w-1/3', height: 'h-full', isLeftColumn: true }, // Portrait à gauche
          { width: 'md:w-2/3', height: 'h-1/2', isRightColumn: true, isTop: true },  // Paysage 1 en haut à droite
          { width: 'md:w-2/3', height: 'h-1/2', isRightColumn: true, isBottom: true }   // Paysage 2 en bas à droite
        ],
        useColumns: true
      },
      {
        name: 'landscape-top-portrait-bottom',
        description: 'Deux paysages en haut, portrait en bas',
        structure: [
          { width: 'md:w-1/2', height: 'h-1/2' },  // Paysage 1 en haut gauche
          { width: 'md:w-1/2', height: 'h-1/2' },  // Paysage 2 en haut droite
          { width: 'w-full', height: 'h-1/2' }     // Portrait en bas pleine largeur
        ]
      },
      {
        name: 'three-column-grid',
        description: 'Trois images en colonnes égales',
        structure: [
          { width: 'md:w-1/3', height: 'h-full' },
          { width: 'md:w-1/3', height: 'h-full' },
          { width: 'md:w-1/3', height: 'h-full' }
        ]
      },
      {
        name: 'full-top-two-bottom',
        description: 'Image pleine largeur en haut, deux images en bas',
        structure: [
          { width: 'w-full', height: 'h-2/3' },    // Image pleine largeur en haut
          { width: 'md:w-1/2', height: 'h-1/3' },  // Image 1 en bas gauche
          { width: 'md:w-1/2', height: 'h-1/3' }   // Image 2 en bas droite
        ]
      },
      {
        name: 'two-left-one-right',
        description: 'Deux images à gauche, une grande à droite',
        structure: [
          { width: 'md:w-1/2', height: 'h-1/2', isLeftColumn: true },  // Image 1 en haut gauche
          { width: 'md:w-1/2', height: 'h-1/2', isLeftColumn: true },  // Image 2 en bas gauche
          { width: 'md:w-1/2', height: 'h-full', isRightColumn: true }  // Image 3 pleine hauteur à droite
        ],
        useColumns: true
      }
    ];

    // Fonction pour précharger une image
    function preloadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
        img.src = src;
      });
    }

    async function preloadAllImages(images) {
      const preloadPromises = images.map(img => 
        preloadImage(img.src).catch(() => null)
      );
      return Promise.all(preloadPromises);
    }

    function getRandomLayout() {
      return LAYOUTS[Math.floor(Math.random() * LAYOUTS.length)];
    }

    function organizeImagesForLayout(images, layout) {
      const shuffledImages = [...images].sort(() => Math.random() - 0.5);
      
      const portraitImages = shuffledImages.filter(img => img.format === 'portrait');
      const landscapeImages = shuffledImages.filter(img => img.format === 'landscape');
      const portraits = portraitImages.length > 0 ? portraitImages : shuffledImages.filter(img => img.category === 'portraits');
      const landscapes = landscapeImages.length > 0 ? landscapeImages : shuffledImages.filter(img => img.category === 'nature');
      
      const organized = [];
      const usedImages = new Set();
      let portraitIndex = 0;
      let landscapeIndex = 0;
      let allImagesIndex = 0;
      
      layout.structure.forEach((cell, index) => {
        let selectedImage;
        
        if (layout.name === 'portrait-left-landscape-right') {
          if (index === 0) {
            if (portraits.length > 0) {
              selectedImage = portraits[portraitIndex % portraits.length];
              portraitIndex++;
            } else {
              selectedImage = shuffledImages[allImagesIndex % shuffledImages.length];
              allImagesIndex++;
            }
          } else {
            if (landscapes.length > 0) {
              selectedImage = landscapes[landscapeIndex % landscapes.length];
              landscapeIndex++;
            } else {
              selectedImage = shuffledImages[allImagesIndex % shuffledImages.length];
              allImagesIndex++;
            }
          }
        } else if (layout.name === 'landscape-top-portrait-bottom') {
          if (index < 2) {
            if (landscapes.length > 0) {
              selectedImage = landscapes[landscapeIndex % landscapes.length];
              landscapeIndex++;
            } else {
              selectedImage = shuffledImages[allImagesIndex % shuffledImages.length];
              allImagesIndex++;
            }
          } else {
            if (portraits.length > 0) {
              selectedImage = portraits[portraitIndex % portraits.length];
              portraitIndex++;
            } else {
              selectedImage = shuffledImages[allImagesIndex % shuffledImages.length];
              allImagesIndex++;
            }
          }
        } else {
          let foundImage = false;
          for (let i = 0; i < shuffledImages.length; i++) {
            const candidate = shuffledImages[(index + i) % shuffledImages.length];
            if (!usedImages.has(candidate.src)) {
              selectedImage = candidate;
              usedImages.add(candidate.src);
              foundImage = true;
              break;
            }
          }
          
          if (!foundImage) {
            selectedImage = shuffledImages[index % shuffledImages.length];
          }
        }
        
        if (selectedImage) {
          organized.push({
            ...selectedImage,
            layoutCell: cell
          });
        }
      });
      
      return organized;
    }

    let cachedImages = null;
    let currentLayout = null;
    let currentImageIndices = [];
    let cycleInterval = null;
    let lastChangedCell = -1;
    
    function createLayoutStructure(layout, organizedImages) {
      const grid = document.getElementById('portfolio-grid');
      if (!grid) return;
      
      grid.innerHTML = '';
      
      if (layout.useColumns) {
        grid.className = 'flex w-full h-full';
        
        let leftWidth, rightWidth;
        if (layout.name === 'two-left-one-right') {
          leftWidth = 'md:w-1/2';
          rightWidth = 'md:w-1/2';
        } else {
          leftWidth = 'md:w-1/3';
          rightWidth = 'md:w-2/3';
        }
        
        const leftColumn = document.createElement('div');
        leftColumn.className = `flex flex-col ${leftWidth} w-full h-full`;
        
        const rightColumn = document.createElement('div');
        rightColumn.className = `flex flex-col ${rightWidth} w-full h-full`;
        
        organizedImages.forEach((img, index) => {
          if (!img || !img.layoutCell) return;
          
          const cellContainer = document.createElement('div');
          cellContainer.className = `w-full ${img.layoutCell.height} relative overflow-hidden`;
          cellContainer.dataset.cellIndex = index;
          
          const imageStack = document.createElement('div');
          imageStack.className = 'absolute inset-0';
          
          const imgElement = document.createElement('img');
          imgElement.src = img.src;
          imgElement.alt = img.alt || 'Portfolio image';
          imgElement.className = 'block h-full w-full object-cover object-center opacity-100 transition-opacity duration-1000';
          imgElement.dataset.imageIndex = index;
          imageStack.appendChild(imgElement);
          
          cellContainer.appendChild(imageStack);
          
          if (img.layoutCell.isLeftColumn) {
            leftColumn.appendChild(cellContainer);
          } else if (img.layoutCell.isRightColumn) {
            rightColumn.appendChild(cellContainer);
          }
        });
        
        grid.appendChild(leftColumn);
        grid.appendChild(rightColumn);
      } else {
        grid.className = 'flex flex-wrap w-full h-full items-stretch';
        
        const hasPartialHeights = organizedImages.some(img => 
          img.layoutCell.height && (img.layoutCell.height.includes('1/3') || img.layoutCell.height.includes('2/3'))
        );
        
        if (hasPartialHeights) {
          grid.style.display = 'flex';
          grid.style.flexWrap = 'wrap';
          grid.style.height = '100%';
        }
        
        organizedImages.forEach((img, index) => {
          if (!img || !img.layoutCell) return;
          
          const cellContainer = document.createElement('div');
          cellContainer.className = `w-full ${img.layoutCell.width} relative overflow-hidden`;
          
          if (img.layoutCell.height) {
            if (img.layoutCell.height === 'h-full') {
              cellContainer.style.height = '100%';
            } else if (img.layoutCell.height === 'h-1/2') {
              cellContainer.style.height = '50%';
            } else if (img.layoutCell.height === 'h-1/3') {
              cellContainer.style.height = '33.333333%';
            } else if (img.layoutCell.height === 'h-2/3') {
              cellContainer.style.height = '66.666667%';
            }
          }
          
          cellContainer.dataset.cellIndex = index;
          
          const imageStack = document.createElement('div');
          imageStack.className = 'absolute inset-0';
          
          const imgElement = document.createElement('img');
          imgElement.src = img.src;
          imgElement.alt = img.alt || 'Portfolio image';
          imgElement.className = 'block h-full w-full object-cover object-center opacity-100 transition-opacity duration-1000';
          imgElement.dataset.imageIndex = index;
          imageStack.appendChild(imgElement);
          
          cellContainer.appendChild(imageStack);
          grid.appendChild(cellContainer);
        });
      }
    }
    
    function changeImageInCell(cellIndex, newImage) {
      const grid = document.getElementById('portfolio-grid');
      if (!grid) return;
      
      const cellContainer = grid.querySelector(`[data-cell-index="${cellIndex}"]`);
      if (!cellContainer) return;
      
      const imageStack = cellContainer.querySelector('div');
      if (!imageStack) return;
      
      const newImgElement = document.createElement('img');
      newImgElement.src = newImage.src;
      newImgElement.alt = newImage.alt || 'Portfolio image';
      newImgElement.className = 'block h-full w-full object-cover object-center opacity-0 transition-opacity duration-1000 absolute inset-0';
      newImgElement.dataset.imageIndex = cellIndex;
      
      imageStack.appendChild(newImgElement);
      
      const oldImg = imageStack.querySelector('img:not(:last-child)');
      if (oldImg) {
        oldImg.style.opacity = '0';
        setTimeout(() => {
          oldImg.remove();
        }, 1000);
      }
      
      setTimeout(() => {
        newImgElement.style.opacity = '1';
      }, 50);
    }
    
    async function renderBackgroundCanvas(useTransition = false) {
      try {
        const grid = document.getElementById('portfolio-grid');
        if (!grid) {
          console.error('Portfolio grid element not found');
          return;
        }
        
        // Vérifier que IMAGES_CONFIG est disponible
        if (typeof IMAGES_CONFIG === 'undefined') {
          console.error('IMAGES_CONFIG is not defined. Make sure dist/images-config.js is loaded.');
          return;
        }
        
        if (!cachedImages) {
          cachedImages = IMAGES_CONFIG.getAllImages('./');
          
          if (!cachedImages || cachedImages.length === 0) {
            console.error('No images found in configuration');
            return;
          }
          
          try {
            await Promise.race([
              preloadAllImages(cachedImages),
              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 5000))
            ]);
          } catch (err) {
            // Continue even if some images fail to preload
          }
        }
        
        const allImages = cachedImages;
        
        if (useTransition) {
          grid.style.opacity = '0';
          grid.style.transition = 'opacity 0.5s ease-in-out';
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        grid.innerHTML = '';
        
        const selectedLayout = getRandomLayout();
        const organizedImages = organizeImagesForLayout(allImages, selectedLayout);
        
        if (!organizedImages || organizedImages.length === 0) {
          console.error('No images organized for layout');
          return;
        }
        
        currentLayout = selectedLayout;
        currentImageIndices = organizedImages.map((img, idx) => 
          allImages.findIndex(ai => ai.src === img.src)
        );
        
        lastChangedCell = -1;
        createLayoutStructure(selectedLayout, organizedImages);
      } catch (error) {
        console.error('Error rendering background canvas:', error);
        const grid = document.getElementById('portfolio-grid');
        if (grid) {
          grid.innerHTML = '<div class="w-full h-full bg-gray-800 flex items-center justify-center text-white">Erreur de chargement des images</div>';
        }
      }
    }
    
    function cycleNextImage() {
      if (!currentLayout || !cachedImages || currentImageIndices.length === 0) {
        return;
      }
      
      let availableCells = [];
      for (let i = 0; i < currentImageIndices.length; i++) {
        if (i !== lastChangedCell) {
          availableCells.push(i);
        }
      }
      
      if (availableCells.length === 0) {
        availableCells = [0];
      }
      
      const cellIndex = availableCells[Math.floor(Math.random() * availableCells.length)];
      const currentImageIndex = currentImageIndices[cellIndex];
      
      const usedImageIndices = new Set(currentImageIndices);
      let newImageIndex;
      let attempts = 0;
      const maxAttempts = 100;
      
      do {
        newImageIndex = Math.floor(Math.random() * cachedImages.length);
        attempts++;
      } while ((newImageIndex === currentImageIndex || usedImageIndices.has(newImageIndex)) && attempts < maxAttempts);
      
      if (attempts >= maxAttempts) {
        do {
          newImageIndex = Math.floor(Math.random() * cachedImages.length);
        } while (newImageIndex === currentImageIndex);
      }
      
      const newImage = cachedImages[newImageIndex];
      currentImageIndices[cellIndex] = newImageIndex;
      lastChangedCell = cellIndex;
      
      changeImageInCell(cellIndex, newImage);
    }
    
    function startProgressiveCycle() {
      if (cycleInterval) {
        clearInterval(cycleInterval);
      }
      
      cycleInterval = setInterval(() => {
        cycleNextImage();
      }, 2500);
    }
    
    function startAutoCycle() {
      startProgressiveCycle();
    }
    
    let currentLanguage = 'fr';
    let languageInterval = null;
    
    function cycleLanguage() {
      const buttonTextFr = document.getElementById('button-text-fr');
      const buttonTextEn = document.getElementById('button-text-en');
      
      if (!buttonTextFr || !buttonTextEn) return;
      
      if (currentLanguage === 'fr') {
        requestAnimationFrame(() => {
          buttonTextEn.style.opacity = '1';
          setTimeout(() => {
            requestAnimationFrame(() => {
              buttonTextFr.style.opacity = '0';
            });
          }, 150);
        });
        currentLanguage = 'en';
      } else {
        requestAnimationFrame(() => {
          buttonTextFr.style.opacity = '1';
          setTimeout(() => {
            requestAnimationFrame(() => {
              buttonTextEn.style.opacity = '0';
            });
          }, 150);
        });
        currentLanguage = 'fr';
      }
    }
    
    function startLanguageCycle() {
      if (languageInterval) {
        clearInterval(languageInterval);
      }
      
      const initialDelay = 3000 + Math.random() * 4000;
      
      setTimeout(() => {
        cycleLanguage();
        languageInterval = setInterval(() => {
          cycleLanguage();
        }, 4700);
      }, initialDelay);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof IMAGES_CONFIG === 'undefined') {
        console.error('IMAGES_CONFIG is not defined. Make sure dist/images-config.js is loaded.');
        const script = document.createElement('script');
        script.src = 'dist/images-config.js';
        script.onload = function() {
          renderBackgroundCanvas().then(() => {
            startAutoCycle();
            startLanguageCycle();
          });
        };
        script.onerror = function() {
          console.error('Failed to load images-config.js');
        };
        document.head.appendChild(script);
      } else {
        renderBackgroundCanvas().then(() => {
          startAutoCycle();
          startLanguageCycle();
        });
      }
    });
  </script>
  <script src="js/fade_in.js"></script>
</body>

</html>